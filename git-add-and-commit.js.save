var nodegit = require('nodegit')

var fileName = "gitcommitlog.js";
var directoryName = process.cwd();


var repo;
var index;
var oid;

function commitFile(filename){

nodegit.Repository.open('./')
.then(function(repoResult) {
  repo = repoResult;
})
.then(function() {
  return repo.refreshIndex();
})
.then(function(indexResult) {
    console.log(indexResult)
  index = indexResult;
})
.then(function() {
  // this file is in the root of the directory and doesn't need a full path
  return index.addByPath(fileName);
})
// .then(function() {
//   // this file is in a subdirectory and can use a relative path
//   return index.addByPath(path.posix.join(directoryName, fileName));
// })
.then(function() {
  // this will write both files to the index
  return index.write();
})
.then(function() {
  return index.writeTree();
})
.then(function(oidResult) {
  oid = oidResult;
  return nodegit.Reference.nameToId(repo, "HEAD");
})
.then(function(head) {
  return repo.getCommit(head);
})
.then(function(parent) {
  var author = nodegit.Signature.now("Suresh",
    "suresh@dailykit.org");
  var committer = nodegit.Signature.now("Suresh",
    "suresh@dailykit.org");

  return repo.createCommit("HEAD", author, committer, "message", oid, [parent]);
})
.done(function(commitId) {
  console.log("New Commit: ", commitId);
});

}

}
